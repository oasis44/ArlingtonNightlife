<template>
	<div class="page" data-name="main">

	  <!-- Top Navbar -->
	  <div class="navbar">
		<div class="navbar-inner">
		  <div class="title">Arlington Nightlife</div>
		</div>
	  </div>

	  <!-- Toolbar -->
	  <div class="toolbar">
		<div class="toolbar-inner">
		  <!-- Toolbar links -->
		  {{#if loginData}}
			<a href="/admin" class="link">Administration</a>
		  {{else}}
		    <a href="/login" class="link">Login</a>
		  {{/if}}
		</div>
	  </div>

	  <!-- Scrollable page content -->
	  <div class="page-content">
	  
		<div class="list">
		  <ul>
			<!-- Smart select item -->
			<li>
			  <!-- Additional "smart-select" class -->
			  <a href="#" class="item-link smart-select" data-close-on-select="true">
				<!-- select -->
				<select name="eventSelect">
				  <option value="Happy Hour" selected>Happy Hours</option>
				  <option value="Live Music Event">Live Music</option>
				  <option value="Other Event">Other Events</option>
				</select>
				<div class="item-content" id="events">
				  <div class="item-inner">
					<!-- Select label -->
					<div class="item-title">Event Type</div>
					<!-- Selected value, not required -->
					<div class="item-after">Happy Hours</div>
				  </div>
				</div>
			  </a>
			</li>
		  </ul>
		</div>
		
		<div class="app-body">
			<h3>{{eventType}}</h3>
			
			<div class="data-table card">
				<table>
					<thead>
						<tr>
							<th class="label-cell">Restaurant/Bar</th>
							<th class="label-cell">Start Time</th>
							<th class="label-cell">End Time</th>
						</tr>
					</thead>
					<tbody>
						{{#each events}}
							<tr>
								<td class="label-cell"><a href="/venues/{{venue_id}}">{{venue_name}}</a></td>
								<td class="label-cell">{{start_time}}</td>
								<td class="label-cell">{{end_time}}</td>
							</tr>
						{{/each}}
					</tbody>
				</table>
			</div>
			
			<!-- Link to another page -->
			<a href="/about/">About app</a>
		</div>
	  </div>
	</div>
</template>
<script>
	return {
		data: function () {
			var self = this;
			var app = self.$app;
			
			return {
				events: []
			}
		},
		methods: {
			fetchEvents() {
				var self = this;
				
				$$('select[name="eventSelect"] option:checked').each(function () {
					var eventType = this.value;
					
					self.$setState({
						eventType: eventType
					});
				
					Framework7.request.get('/api/events', {'eventType': eventType}, function (data) {
						self.$setState({
							events: JSON.parse(data)
						})
					});
				});
			}
		},
		on: {
			pageInit() {
				var self = this;
				var loginData = app.form.getFormData('login')

				if (loginData) {
					self.$setState({
						loginData: loginData
					})
				}
				this.fetchEvents()
			},
			pageReinit() {
				this.fetchEvents()
			}
		}
	}
</script>